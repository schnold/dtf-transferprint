---
import "../assets/app.css";
import Footer from "../components/Footer.astro";
import BlockOverlay from "../components/BlockOverlay.astro";
import CookieBanner from "../components/CookieBanner.astro";
import LoadingOverlay from "../components/LoadingOverlay.astro";
import SEOHead from "../components/seo/SEOHead.astro";
import OrganizationSchema from "../components/seo/schemas/OrganizationSchema.astro";
import WebSiteSchema from "../components/seo/schemas/WebSiteSchema.astro";

interface Props {
	title?: string;
	description?: string;
	image?: string;
	type?: 'website' | 'article' | 'product';
	noindex?: boolean;
	includeWebSiteSchema?: boolean; // For homepage only
	organizationRating?: {
		ratingValue: number;
		reviewCount: number;
	};
	foundingDate?: string;
	preloadHeroImage?: string; // For preloading hero/LCP images
}

const {
	title = "DTF Transfer Print - Professional Print Solutions",
	description = "High-quality DTF transfers, custom printing, and fast turnaround times. Your vision, our expertise.",
	image,
	type = 'website',
	noindex = false,
	includeWebSiteSchema = false,
	organizationRating,
	foundingDate,
	preloadHeroImage
} = Astro.props;
---

<!doctype html>
<html lang="de" data-theme="custom">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<!-- Preconnect to external domains for faster resource loading -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<!-- Preload LCP hero image if provided -->
		{preloadHeroImage && (
			<link
				rel="preload"
				as="image"
				href={preloadHeroImage}
				fetchpriority="high"
			/>
		)}
		<!-- Load fonts with display=swap to prevent FOIT (Flash of Invisible Text) -->
		<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'" />
		<noscript>
			<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
		</noscript>
		<title>{title}</title>
		<SEOHead
			title={title}
			description={description}
			canonical={Astro.url.href}
			image={image}
			type={type}
			noindex={noindex}
		/>
	</head>
	<body class="flex flex-col min-h-screen bg-base-200 bg-gradient-to-br from-base-200 via-base-100 to-base-200">
		<BlockOverlay />
		<LoadingOverlay />
		<div class="flex-1">
			<slot />
		</div>
		<Footer />
    <CookieBanner />
		<OrganizationSchema
			aggregateRating={organizationRating}
			foundingDate={foundingDate}
		/>
		{includeWebSiteSchema && <WebSiteSchema />}
    <script type="module">
      // Simple intersection observer for scroll animations
      // Using type="module" for better browser support and async loading
      document.addEventListener('DOMContentLoaded', () => {
        // Check if user prefers reduced motion
        // @ts-ignore
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        
        if (prefersReducedMotion) return;

        const observerOptions = {
          root: null,
          rootMargin: '0px',
          threshold: 0.1
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        }, observerOptions);

        // Target text elements in the main content area (inside the flex-1 div which acts as main wrapper)
        const contentWrapper = document.querySelector('.flex-1');
        if (!contentWrapper) return;

        // Select all text-heavy elements and cards/containers within the content wrapper
        const elements = contentWrapper.querySelectorAll('h1, h2, h3, h4, h5, h6, p, li, blockquote, .reveal-text, .card, .stat, .service-card, .faq-item, .btn, img:not(.hero-bg-layer)');
        
        elements.forEach((el) => {
          el.classList.add('reveal-text');
          observer.observe(el);
        });
      });
    </script>
  </body>
</html>
