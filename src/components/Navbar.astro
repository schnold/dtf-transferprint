---
import { SITE_CONFIG } from '../constants/site';
import AuthModal from './AuthModal.astro';
import CartDropdown from './CartDropdown.astro';
import CategoryIcon from './CategoryIcon.astro';
import PromoBanner from './PromoBanner.astro';
import { pool } from '../lib/db';

const user = Astro.locals.user;

// Optimized query: Fetch ALL categories hierarchically with their products in ONE query using recursive CTE
const client = await pool.connect();
let categoriesWithProducts = [];
let categoryHierarchy = [];
try {
	const result = await client.query(`
		WITH RECURSIVE category_tree AS (
			-- Base case: root categories (hierarchy level 0)
			SELECT
				c.id,
				c.name,
				c.slug,
				c."displayOrder",
				c."parentId",
				c.icon,
				c.description,
				0 as level,
				ARRAY[c."displayOrder", 0, 0, 0] as sort_path
			FROM categories c
			WHERE c."isActive" = true AND c."parentId" IS NULL

			UNION ALL

			-- Recursive case: child categories
			SELECT
				c.id,
				c.name,
				c.slug,
				c."displayOrder",
				c."parentId",
				c.icon,
				c.description,
				ct.level + 1,
				ct.sort_path[1:ct.level+1] || ARRAY[c."displayOrder"] || ARRAY[0, 0, 0]
			FROM categories c
			INNER JOIN category_tree ct ON c."parentId" = ct.id
			WHERE c."isActive" = true
		)
		SELECT
			ct.id,
			ct.name,
			ct.slug,
			ct."displayOrder",
			ct."parentId",
			ct.icon,
			ct.description,
			ct.level,
			COALESCE(
				json_agg(
					json_build_object(
						'id', p.id,
						'slug', p.slug,
						'name', p.name,
						'shortDescription', p."shortDescription",
						'basePrice', p."basePrice",
						'isFeatured', p."isFeatured"
					)
					ORDER BY p."isFeatured" DESC, p.name
				) FILTER (WHERE p.id IS NOT NULL),
				'[]'::json
			) as products
		FROM category_tree ct
		LEFT JOIN products p ON ct.id = p."categoryId" AND p."isActive" = true
		GROUP BY ct.id, ct.name, ct.slug, ct."displayOrder", ct."parentId", ct.icon, ct.description, ct.level, ct.sort_path
		ORDER BY ct.sort_path, ct.name
	`);

	categoriesWithProducts = result.rows.map(cat => ({
		...cat,
		products: (Array.isArray(cat.products) ? cat.products : []).map(p => ({
			...p,
			basePrice: parseFloat(p.basePrice || 0),
		})),
		level: parseInt(cat.level || 0)
	}));

	// Organize categories by hierarchy
	categoryHierarchy = categoriesWithProducts;
} finally {
	client.release();
}
---

<!-- Promotional Banner -->
<PromoBanner />

<!-- Navbar -->
<div id="navbar-container" class="w-full px-4 sm:px-6 lg:px-8 pt-6 sticky top-0 z-50 navbar-scroll-container">
	<div class="navbar bg-base-100/20 backdrop-blur-xl backdrop-saturate-150 border border-white/20 shadow-lg rounded-2xl px-3 sm:px-4 lg:px-6 py-4 max-w-7xl lg:max-w-7xl-extended mx-auto min-h-[4.5rem] overflow-visible">
		<div class="navbar-start">
			<a href="/" class="px-2 sm:px-4 flex items-center no-underline">
				<img
					src={SITE_CONFIG.brand.logo.primary}
					srcset={SITE_CONFIG.brand.logo.primary2x ? `${SITE_CONFIG.brand.logo.primary} 1x, ${SITE_CONFIG.brand.logo.primary2x} 2x` : undefined}
					alt={SITE_CONFIG.brand.logo.alt}
					class="h-8 sm:h-10 lg:h-10 w-auto object-contain"
					width={200}
					height={60}
					fetchpriority="high"
				/>
			</a>
		</div>
		<div class="navbar-center hidden lg:flex flex-1 min-w-0 justify-center">
			<ul class="flex flex-row flex-wrap gap-0.5 sm:gap-1 px-1 max-w-4xl justify-center lg:justify-start mega-menu">
				<!-- Produkte Mega Menu (Dynamic Categories - Hierarchical) -->
				{categoryHierarchy.length > 0 && (
					<li class="dropdown mega-dropdown mega-dropdown-produkte flex-shrink-0 relative">
						<button type="button" class="text-neutral/80 hover:text-neutral hover:bg-white/10 px-2 sm:px-3 lg:px-4 py-2 rounded-md transition-all duration-200 cursor-pointer flex items-center gap-1.5 text-sm lg:text-base font-medium border-0 bg-transparent" aria-haspopup="true" aria-expanded="false" aria-label="Produkte menu">
							<span>Produkte</span>
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 transition-transform duration-200" aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
							</svg>
						</button>
						<div class="mega-dropdown-content absolute top-full mt-2 bg-base-100 rounded-2xl shadow-2xl border border-base-300/30 p-6 max-w-[900px] opacity-0 invisible transform translate-y-2 transition-all duration-300 ease-out z-50 max-h-[80vh] overflow-y-auto" role="menu" aria-label="Produkte submenu">
							<div class="grid grid-cols-2 gap-6">
								<!-- Render all categories hierarchically in grid columns -->
								{categoryHierarchy.map((category) => (
									<div>
										{/* Level 0: Main Category Headers */}
										{category.level === 0 && (
											<>
												<h3 class="font-bold text-neutral mb-3 text-base flex items-center gap-2">
													<CategoryIcon icon={category.icon || 'folder'} />
													<a href={`/categories/${category.slug}`} class="hover:text-primary transition-colors">
														{category.name}
													</a>
												</h3>
												{category.products.length > 0 && (
													<ul class="space-y-2 mb-4">
														{category.products.map((product) => (
															<li>
																<a href={`/product/${product.slug}`} class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
																	{product.name}
																</a>
															</li>
														))}
													</ul>
												)}
											</>
										)}

										{/* Level 1+: Subcategories (indented) */}
										{category.level > 0 && (
											<div class="mt-3" style={`margin-left: ${category.level * 1}rem;`}>
												<h4 class="font-semibold text-neutral/90 mb-2 text-sm flex items-center gap-2">
													<CategoryIcon icon={category.icon || 'folder'} />
													<a href={`/categories/${category.slug}`} class="hover:text-primary transition-colors">
														{category.name}
													</a>
												</h4>
												{category.products.length > 0 && (
													<ul class="space-y-1.5 ml-6">
														{category.products.map((product) => (
															<li>
																<a href={`/product/${product.slug}`} class="text-neutral/60 menu-link-hover text-xs py-1 transition-colors block break-words">
																	{product.name}
																</a>
															</li>
														))}
													</ul>
												)}
											</div>
										)}
									</div>
								))}
							</div>

							<!-- Textilkatalog Banner -->
							<div class="mt-6 pt-6 border-t border-base-300/20">
								<div class="flex flex-wrap items-center gap-4 bg-primary/5 rounded-lg p-4">
									<a href="https://byselini.printwear.de/de/home" target="_blank" rel="noopener noreferrer" class="hover:opacity-80 transition-opacity">
										<img
											src={SITE_CONFIG.brand.logo.primary}
											alt={SITE_CONFIG.brand.logo.alt}
											class="h-8 w-auto object-contain"
											width={200}
											height={60}
										/>
									</a>
									<a href="https://www.roly.es/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
										<img
											src="https://static.gorfactory.es/images/header/logo_Roly_2025.svg"
											alt="Roly Logo"
											class="h-8 w-auto object-contain"
										/>
										<span class="text-sm font-medium text-neutral">Schau in unseren Textilkatalog</span>
									</a>
								</div>
							</div>

							<!-- View All Products Button -->
							<div class="mt-6 pt-4 border-t border-base-300/20">
								<a href="/products/" class="btn btn-primary btn-sm w-full">Alle Produkte ansehen</a>
							</div>
						</div>
					</li>
				)}

				<!-- Dienstleistungen Mega Menu -->
				<li class="dropdown mega-dropdown mega-dropdown-dienstleistungen flex-shrink-0 relative">
					<label class="text-neutral/80 hover:text-neutral hover:bg-white/10 px-2 sm:px-3 lg:px-4 py-2 rounded-md transition-all duration-200 cursor-pointer flex items-center gap-1.5 text-sm lg:text-base font-medium">
						<span>Dienstleistungen</span>
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 transition-transform duration-200">
							<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
						</svg>
					</label>
					<div class="mega-dropdown-content absolute top-full mt-2 bg-base-100 rounded-2xl shadow-2xl border border-base-300/30 p-6 max-w-[600px] opacity-0 invisible transform translate-y-2 transition-all duration-300 ease-out z-50">
						<div class="grid grid-cols-2 xl:grid-cols-2 gap-5">
							<!-- Druckdienstleistungen -->
							<div>
								<h3 class="font-bold text-neutral mb-3 text-base flex items-center gap-2">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5" style="color: var(--color-metrics-text);">
										<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
									</svg>
									<a href="/druckdienstleistungen/" class="hover:text-primary transition-colors">
										Druckdienstleistungen
									</a>
								</h3>
								<ul class="space-y-2">
									<li><a href="/siebdruck/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Siebdruck
									</a></li>
									<li><a href="/dtf-transfers/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										DTF Transfers
									</a></li>
									<li><a href="/sublimation/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Sublimation
									</a></li>
									<li><a href="/flex-und-flockfoliendruck/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Flex und Flockfoliendruck
									</a></li>
									<li><a href="/direkteinstickung/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Stickerei
									</a></li>
									<li><a href="/einzelnamendruck/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Einzelnamendruck
									</a></li>
									<li><a href="/einzelnamenstick/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Einzelnamenstick
									</a></li>
									<li><a href="/flex-flock-einzelnamen-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Flex & Flock Einzelnamen bedrucken
									</a></li>
									<li><a href="/plastisol-transfer/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Plastisol Transfer
									</a></li>
									<li><a href="/reflex-transfer/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Reflex Transfer
									</a></li>
									<li><a href="/gewebte-aufnaeher/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Gewebte Aufnäher
									</a></li>
									<li><a href="/gewebte-label/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Gewebte Label
									</a></li>
									<li><a href="/stick-patches/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Stick-Patches
									</a></li>
								</ul>
							</div>

							<!-- Zusatzleistungen -->
							<div>
								<h3 class="font-bold text-neutral mb-3 text-base flex items-center gap-2">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5" style="color: var(--color-metrics-text);">
										<path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
									</svg>
									Zusatzleistungen
								</h3>
								<ul class="space-y-2">
									<li><a href="/druckvorlagen/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Druckvorlagen
									</a></li>
									<li><a href="/beratung/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Fachberatung
									</a></li>
									<li><a href="/support/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Technischer Support
									</a></li>
								</ul>
								<div class="mt-6 pt-4 border-t border-base-300/20">
									<a href="#contact" class="btn btn-primary btn-sm w-full">Angebot anfordern</a>
								</div>
							</div>
						</div>
					</div>
				</li>

				<!-- Themen Mega Menu -->
				<li class="dropdown mega-dropdown mega-dropdown-themen flex-shrink-0 relative">
					<button type="button" class="text-neutral/80 hover:text-neutral hover:bg-white/10 px-2 sm:px-3 lg:px-4 py-2 rounded-md transition-all duration-200 cursor-pointer flex items-center gap-1.5 text-sm lg:text-base font-medium border-0 bg-transparent" aria-haspopup="true" aria-expanded="false" aria-label="Themen menu">
						<span>Themen</span>
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 transition-transform duration-200" aria-hidden="true">
							<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
						</svg>
					</button>
					<div class="mega-dropdown-content absolute top-full mt-2 bg-base-100 rounded-2xl shadow-2xl border border-base-300/30 p-6 max-w-[800px] opacity-0 invisible transform translate-y-2 transition-all duration-300 ease-out z-50" role="menu" aria-label="Themen submenu">
						<div class="mb-4 pb-4 border-b border-base-300/20">
							<a href="/themen/" class="font-bold text-primary hover:underline text-base">Themen – Übersicht</a>
						</div>
						<div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
							<!-- Textilthemen -->
							<div>
								<h3 class="font-bold text-neutral mb-3 text-base">Textilthemen</h3>
								<ul class="space-y-2">
									<li><a href="/themen/t-shirts-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">T-Shirts bedrucken</a></li>
									<li><a href="/themen/schuerzen-besticken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Schürzen besticken</a></li>
									<li><a href="/themen/kappen-veredeln/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Kappen veredeln</a></li>
									<li><a href="/themen/baumwolltaschen-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Baumwolltaschen bedrucken</a></li>
									<li><a href="/themen/muetzen-besticken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Mützen besticken</a></li>
									<li><a href="/themen/softshelljacken-besticken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Softshelljacken besticken</a></li>
									<li><a href="/themen/schal-besticken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Schal besticken</a></li>
									<li><a href="/themen/handtuecher-besticken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Handtücher besticken</a></li>
									<li><a href="/themen/bandshirts-drucken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Bandshirts drucken</a></li>
									<li><a href="/themen/fanwear-sv-darmstadt-98/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Fanwear SV Darmstadt 98</a></li>
									<li><a href="/themen/modelabel-gruenden/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Modelabel gründen</a></li>
								</ul>
							</div>
							<!-- Sportbekleidung -->
							<div>
								<h3 class="font-bold text-neutral mb-3 text-base">Sportbekleidung</h3>
								<ul class="space-y-2">
									<li><a href="/themen/sportbekleidung-bedrucken/laufshirts-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Laufshirts bedrucken</a></li>
									<li><a href="/themen/sportbekleidung-bedrucken/laufshirts-komplett-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Laufshirts komplett bedrucken</a></li>
									<li><a href="/themen/sportbekleidung-bedrucken/trikots-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Trikots bedrucken</a></li>
									<li><a href="/themen/sportbekleidung-bedrucken/fahrradtrikot-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Fahrradtrikot Bedrucken</a></li>
									<li><a href="/themen/sportbekleidung-bedrucken/poloshirts-komplett-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Poloshirts komplett bedrucken</a></li>
									<li><a href="/themen/sportbekleidung-bedrucken/esport-teamware/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">eSport Teamware</a></li>
									<li><a href="/themen/sportbekleidung-bedrucken/eishockey-shirts/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Eishockey Shirts</a></li>
									<li><a href="/themen/sportbekleidung-bedrucken/hoodies-komplett-bedruckt/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Hoodies komplett bedruckt</a></li>
									<li><a href="/themen/sportbekleidung-bedrucken/trainingsjacken-komplett-bedruckt/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Trainingsjacken komplett bedruckt</a></li>
									<li><a href="/themen/sportbekleidung-bedrucken/business-runs-firmenlauf/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Business Runs &amp; Firmenläufe</a></li>
									<li><a href="/themen/sportbekleidung-bedrucken/rucksackbeutel-komplett-bedruckt/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Rucksackbeutel komplett bedruckt</a></li>
								</ul>
							</div>
							<!-- Arbeitskleidung -->
							<div>
								<h3 class="font-bold text-neutral mb-3 text-base">Arbeitskleidung</h3>
								<ul class="space-y-2">
									<li><a href="/arbeitskleidung/kasacks-besticken-medizin-bekleidung/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">Kasacks / Medizinische Berufsbekleidung</a></li>
								</ul>
							</div>
						</div>
					</div>
				</li>

				<!-- Informationen Mega Menu -->
				<li class="dropdown mega-dropdown mega-dropdown-informationen flex-shrink-0 relative">
					<button type="button" class="text-neutral/80 hover:text-neutral hover:bg-white/10 px-2 sm:px-3 lg:px-4 py-2 rounded-md transition-all duration-200 cursor-pointer flex items-center gap-1.5 text-sm lg:text-base font-medium border-0 bg-transparent" aria-haspopup="true" aria-expanded="false" aria-label="Informationen menu">
						<span>Informationen</span>
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 transition-transform duration-200" aria-hidden="true">
							<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
						</svg>
					</button>
					<div class="mega-dropdown-content absolute top-full mt-2 bg-base-100 rounded-2xl shadow-2xl border border-base-300/30 p-6 max-w-[750px] opacity-0 invisible transform translate-y-2 transition-all duration-300 ease-out z-50" role="menu" aria-label="Informationen submenu">
						<div class="grid grid-cols-2 xl:grid-cols-3 gap-5">
							<!-- Unternehmen -->
							<div>
								<h3 class="font-bold text-neutral mb-3 text-base flex items-center gap-2">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5" style="color: var(--color-metrics-text);">
										<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" />
									</svg>
									Unternehmen
								</h3>
								<ul class="space-y-2">
									<li><a href="/ueber-uns/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Über Uns
									</a></li>
									<li><a href="/karriere/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Stellenangebote
									</a></li>
								</ul>
							</div>

							<!-- DTF-Ratgeber (disabled for now)
							<div>
								<h3 class="font-bold text-neutral mb-3 text-base flex items-center gap-2">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5" style="color: var(--color-metrics-text); transform: scaleY(-1);">
										<path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
									</svg>
									DTF-Ratgeber
								</h3>
								<ul class="space-y-2">
									<li><a href="/dtf-ratgeber-und-infos/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										DTF Grundlagen
									</a></li>
									<li><a href="/dtf-druck/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										DTF Druckprozess
									</a></li>
									<li><a href="/dtf-haltbarkeit/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										DTF Haltbarkeit
									</a></li>
									<li><a href="/infos-zu-printpunk/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Tipps & Tricks
									</a></li>
									<li><a href="/textildruckverfahren/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Textildruckverfahren
									</a></li>
								</ul>
							</div>
							-->

							<!-- Support -->
							<div>
								<h3 class="font-bold text-neutral mb-3 text-base flex items-center gap-2">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5" style="color: var(--color-metrics-text);">
										<path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" />
									</svg>
									Support & FAQ
								</h3>
								<ul class="space-y-2">
									<li><a href="/faq/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Häufige Fragen
									</a></li>
									<li><a href="/kontakt/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Kontakt
									</a></li>
									<li><a href="/support/" class="text-neutral/70 menu-link-hover text-sm py-1.5 transition-colors block break-words">
										Technischer Support
									</a></li>
								</ul>
								<div class="mt-6 pt-4 border-t border-base-300/20">
									<div class="text-center">
										<p class="text-xs text-neutral/60 mb-2">24/7 Support</p>
										<a href="https://wa.me/4917660976813" target="_blank" rel="noopener noreferrer" aria-label="Jetzt anrufen (WhatsApp)" class="btn btn-outline btn-primary btn-xs">Jetzt anrufen</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</li>

				<!-- Muster bestellen - Simple Link -->
				<li class="flex-shrink-0">
					<a href="/muster-bestellen/" class="text-neutral/80 hover:text-neutral hover:bg-white/10 px-2 sm:px-3 lg:px-4 py-2 rounded-md transition-all duration-200 flex items-center gap-1.5 text-sm lg:text-base font-medium">
						<span>Muster bestellen</span>
					</a>
				</li>
			</ul>
		</div>
		<div class="navbar-end flex items-center gap-3 sm:gap-4 flex-shrink-0">
			<!-- Angebot erhalten Button -->
			<a href="/kontakt/" class="btn btn-outline btn-primary btn-sm hidden sm:flex">
				Angebot erhalten
			</a>
			<!-- Auth Section -->
			{user ? (
				<>
					<!-- Cart Dropdown Component -->
					<CartDropdown />

					<!-- User Icon -->
				<!-- Logged In: User Icon with Accent Color -->
				<div class="dropdown relative user-dropdown">
					<button
						class="w-10 h-10 min-w-[2.5rem] min-h-[2.5rem] flex-shrink-0 rounded-full border-2 flex items-center justify-center hover:bg-accent/10 transition-all duration-200 cursor-pointer"
						style="border-color: #4B5563;"
						aria-label="User menu"
						aria-haspopup="true"
						aria-expanded="false"
					>
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4" style="color: #4B5563;">
							<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
						</svg>
					</button>
					<ul class="user-dropdown-content absolute right-0 top-full mt-3 z-[1] p-6 shadow-2xl bg-base-100 rounded-xl w-80 border border-base-300/30 overflow-hidden opacity-0 invisible transform translate-y-2 transition-all duration-300 ease-out" role="menu">
						<!-- Header -->
						<div class="pt-6 pb-4 bg-base-100 border-b border-base-200">
							<div class="flex items-center gap-3 mb-2">
								<div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" style="color: var(--color-metrics-text);">
										<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
									</svg>
								</div>
								<div class="flex-1 min-w-0">
									<p class="text-base font-semibold text-base-content truncate">Mein Konto</p>
									<p class="text-sm text-base-content/60 truncate">{user.email}</p>
								</div>
							</div>
						</div>

						<!-- Menu Items -->
						<div class="py-2">
							<li>
								<a href="/auth/account?tab=profile" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-base-200 transition-colors">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-base-content/70">
										<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
									</svg>
									<span class="text-base">Mein Profil</span>
								</a>
							</li>
							{user.isAdmin && (
								<li>
									<a href="/admin" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-base-200 transition-colors bg-primary/5">
										<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5" style="color: var(--color-metrics-text);">
											<path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
											<path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
										</svg>
										<span class="text-base font-medium">Admin Panel</span>
									</a>
								</li>
							)}
							<li>
								<a href="/orders" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-base-200 transition-colors">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-base-content/70">
										<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007ZM8.625 10.5a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm7.5 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
									</svg>
									<span class="text-base">Bestellungen</span>
								</a>
							</li>
						</div>

						<!-- Divider -->
						<div class="border-t border-base-200 my-1"></div>

						<!-- Sign Out -->
						<div class="pb-2">
							<li>
								<button id="logout-button" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-error/10 text-error w-full transition-colors">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
										<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
									</svg>
									<span class="text-base font-medium">Abmelden</span>
								</button>
							</li>
						</div>
					</ul>
				</div>
				</>
			) : (
				<!-- Not Logged In: User Icon -->
				<button
					id="auth-icon-button"
					class="w-10 h-10 min-w-[2.5rem] min-h-[2.5rem] flex-shrink-0 rounded-full border-2 flex items-center justify-center hover:bg-accent/10 transition-all duration-200 cursor-pointer"
					style="border-color: #4B5563;"
					aria-label="Sign in or Sign up"
				>
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 transition-colors" style="color: #4B5563;">
						<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
					</svg>
				</button>
			)}

			<!-- Mobile Menu Dropdown -->
			<div class="dropdown dropdown-end lg:hidden" id="mobile-menu-dropdown">
				<button type="button" class="btn btn-ghost text-neutral hover:bg-white/10 px-2 sm:px-3 min-w-[3rem] min-h-[3rem]" aria-label="Menu" aria-haspopup="true" aria-expanded="false" id="mobile-menu-button">
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6" aria-hidden="true">
						<path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
					</svg>
				</button>
				<div class="dropdown-content mt-3 bg-base-100 rounded-2xl shadow-2xl border border-base-300/30 p-6 w-[calc(100vw-2rem)] max-w-sm max-h-[calc(100vh-8rem)] overflow-y-auto overflow-x-hidden z-50" id="mobile-menu-content" role="menu">
					<div class="space-y-4">
						<!-- Produkte Section (Collapsible) - Hierarchical -->
						<details class="mobile-menu-section" open>
							<summary class="font-bold text-neutral text-lg flex items-center justify-between cursor-pointer py-2">
								<span class="flex items-center gap-2">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5" style="color: var(--color-metrics-text);">
										<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
									</svg>
									Produkte
								</span>
								<svg class="mobile-menu-chevron w-5 h-5 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
								</svg>
							</summary>
							<div class="mt-3 space-y-4 pl-2">
								{categoryHierarchy.map((category) => (
									<div style={category.level > 0 ? `margin-left: ${category.level * 1}rem;` : ""}>
										{/* Level 0: Main Categories */}
										{category.level === 0 && (
											<>
												<h4 class="font-semibold text-neutral mb-2 text-sm flex items-center gap-2">
													<CategoryIcon icon={category.icon || 'folder'} />
													<a href={`/categories/${category.slug}`} class="hover:text-primary transition-colors">
														{category.name}
													</a>
												</h4>
												{category.products.length > 0 && (
													<ul class="space-y-2 pl-6 mb-3">
														{category.products.slice(0, 8).map((product) => (
															<li>
																<a href={`/product/${product.slug}`} class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
																	{product.name}
																</a>
															</li>
														))}
													</ul>
												)}
											</>
										)}

										{/* Level 1+: Subcategories */}
										{category.level > 0 && (
											<>
												<h5 class="font-medium text-neutral/80 mb-2 text-xs flex items-center gap-2">
													<CategoryIcon icon={category.icon || 'folder'} />
													<a href={`/categories/${category.slug}`} class="hover:text-primary transition-colors">
														{category.name}
													</a>
												</h5>
												{category.products.length > 0 && (
													<ul class="space-y-1.5 pl-6 mb-3">
														{category.products.slice(0, 6).map((product) => (
															<li>
																<a href={`/product/${product.slug}`} class="text-neutral/60 menu-link-hover text-xs py-1 transition-colors block">
																	{product.name}
																</a>
															</li>
														))}
													</ul>
												)}
											</>
										)}
									</div>
								))}
								<div class="pt-2">
									<a href="/products/" class="btn btn-primary btn-sm w-full">Alle Produkte ansehen</a>
								</div>
							</div>
						</details>

						<!-- Dienstleistungen Section (Collapsible) -->
						<details class="mobile-menu-section">
							<summary class="font-bold text-neutral text-lg flex items-center justify-between cursor-pointer py-2">
								<span class="flex items-center gap-2">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5" style="color: var(--color-metrics-text);">
										<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
									</svg>
									Dienstleistungen
								</span>
								<svg class="mobile-menu-chevron w-5 h-5 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
								</svg>
							</summary>
							<div class="mt-3 space-y-4 pl-2">
								<!-- Druckdienstleistungen -->
								<div>
									<h4 class="font-semibold text-neutral mb-2 text-sm">
										<a href="/druckdienstleistungen/" class="hover:text-primary transition-colors">
											Druckdienstleistungen
										</a>
									</h4>
									<ul class="space-y-2 pl-6">
										<li>
											<a href="/siebdruck/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Siebdruck
											</a>
										</li>
										<li>
											<a href="/dtf-transfers/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												DTF Transfers
											</a>
										</li>
										<li>
											<a href="/sublimation/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Sublimation
											</a>
										</li>
										<li>
											<a href="/flex-und-flockfoliendruck/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Flex und Flockfoliendruck
											</a>
										</li>
										<li>
											<a href="/direkteinstickung/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Stickerei
											</a>
										</li>
										<li>
											<a href="/einzelnamendruck/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Einzelnamendruck
											</a>
										</li>
										<li>
											<a href="/einzelnamenstick/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Einzelnamenstick
											</a>
										</li>
										<li>
											<a href="/flex-flock-einzelnamen-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Flex & Flock Einzelnamen bedrucken
											</a>
										</li>
										<li>
											<a href="/plastisol-transfer/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Plastisol Transfer
											</a>
										</li>
										<li>
											<a href="/reflex-transfer/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Reflex Transfer
											</a>
										</li>
										<li>
											<a href="/gewebte-aufnaeher/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Gewebte Aufnäher
											</a>
										</li>
										<li>
											<a href="/gewebte-label/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Gewebte Label
											</a>
										</li>
										<li>
											<a href="/stick-patches/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Stick-Patches
											</a>
										</li>
									</ul>
								</div>
								<!-- Zusatzleistungen -->
								<div>
									<h4 class="font-semibold text-neutral mb-2 text-sm">Zusatzleistungen</h4>
									<ul class="space-y-2 pl-6">
										<li>
											<a href="/druckvorlagen/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Druckvorlagen
											</a>
										</li>
										<li>
											<a href="/beratung/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Fachberatung
											</a>
										</li>
										<li>
											<a href="/support/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Technischer Support
											</a>
										</li>
									</ul>
								</div>
								<div class="pt-2">
									<a href="#contact" class="btn btn-primary btn-sm w-full">Angebot anfordern</a>
								</div>
							</div>
						</details>

						<!-- Themen Section (Collapsible) -->
						<details class="mobile-menu-section">
							<summary class="font-bold text-neutral text-lg flex items-center justify-between cursor-pointer py-2">
								<span class="flex items-center gap-2">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5" style="color: var(--color-metrics-text);">
										<path stroke-linecap="round" stroke-linejoin="round" d="M9.59 9.59L12 12m0 0l2.41 2.41M12 12L9.59 14.41M12 12l2.41-2.41" />
									</svg>
									Themen
								</span>
								<svg class="mobile-menu-chevron w-5 h-5 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
								</svg>
							</summary>
							<div class="mt-3 space-y-4 pl-2">
								<div class="pb-2 border-b border-base-300/20">
									<a href="/themen/" class="font-semibold text-primary hover:underline">Themen – Übersicht</a>
								</div>
								<div>
									<h4 class="font-semibold text-neutral mb-2 text-sm">Textilthemen</h4>
									<ul class="space-y-2 pl-6">
										<li><a href="/themen/t-shirts-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">T-Shirts bedrucken</a></li>
										<li><a href="/themen/schuerzen-besticken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Schürzen besticken</a></li>
										<li><a href="/themen/kappen-veredeln/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Kappen veredeln</a></li>
										<li><a href="/themen/baumwolltaschen-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Baumwolltaschen bedrucken</a></li>
										<li><a href="/themen/muetzen-besticken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Mützen besticken</a></li>
										<li><a href="/themen/softshelljacken-besticken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Softshelljacken besticken</a></li>
										<li><a href="/themen/schal-besticken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Schal besticken</a></li>
										<li><a href="/themen/handtuecher-besticken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Handtücher besticken</a></li>
										<li><a href="/themen/bandshirts-drucken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Bandshirts drucken</a></li>
										<li><a href="/themen/fanwear-sv-darmstadt-98/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Fanwear SV Darmstadt 98</a></li>
										<li><a href="/themen/modelabel-gruenden/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Modelabel gründen</a></li>
									</ul>
								</div>
								<div>
									<h4 class="font-semibold text-neutral mb-2 text-sm">Sportbekleidung</h4>
									<ul class="space-y-2 pl-6">
										<li><a href="/themen/sportbekleidung-bedrucken/laufshirts-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Laufshirts bedrucken</a></li>
										<li><a href="/themen/sportbekleidung-bedrucken/laufshirts-komplett-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Laufshirts komplett bedrucken</a></li>
										<li><a href="/themen/sportbekleidung-bedrucken/trikots-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Trikots bedrucken</a></li>
										<li><a href="/themen/sportbekleidung-bedrucken/fahrradtrikot-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Fahrradtrikot Bedrucken</a></li>
										<li><a href="/themen/sportbekleidung-bedrucken/poloshirts-komplett-bedrucken/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Poloshirts komplett bedrucken</a></li>
										<li><a href="/themen/sportbekleidung-bedrucken/esport-teamware/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">eSport Teamware</a></li>
										<li><a href="/themen/sportbekleidung-bedrucken/eishockey-shirts/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Eishockey Shirts</a></li>
										<li><a href="/themen/sportbekleidung-bedrucken/hoodies-komplett-bedruckt/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Hoodies komplett bedruckt</a></li>
										<li><a href="/themen/sportbekleidung-bedrucken/trainingsjacken-komplett-bedruckt/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Trainingsjacken komplett bedruckt</a></li>
										<li><a href="/themen/sportbekleidung-bedrucken/business-runs-firmenlauf/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Business Runs &amp; Firmenläufe</a></li>
										<li><a href="/themen/sportbekleidung-bedrucken/rucksackbeutel-komplett-bedruckt/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Rucksackbeutel komplett bedruckt</a></li>
									</ul>
								</div>
								<div>
									<h4 class="font-semibold text-neutral mb-2 text-sm">Arbeitskleidung</h4>
									<ul class="space-y-2 pl-6">
										<li><a href="/arbeitskleidung/kasacks-besticken-medizin-bekleidung/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">Kasacks / Medizinische Berufsbekleidung</a></li>
									</ul>
								</div>
							</div>
						</details>

						<!-- Informationen Section (Collapsible) -->
						<details class="mobile-menu-section">
							<summary class="font-bold text-neutral text-lg flex items-center justify-between cursor-pointer py-2">
								<span class="flex items-center gap-2">
									<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5" style="color: var(--color-metrics-text);">
										<path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
									</svg>
									Informationen
								</span>
								<svg class="mobile-menu-chevron w-5 h-5 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
								</svg>
							</summary>
							<div class="mt-3 space-y-4 pl-2">
								<!-- Unternehmen -->
								<div>
									<h4 class="font-semibold text-neutral mb-2 text-sm">Unternehmen</h4>
									<ul class="space-y-2 pl-6">
										<li>
											<a href="/ueber-uns/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Über Uns
											</a>
										</li>
										<li>
											<a href="/karriere/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Stellenangebote
											</a>
										</li>
									</ul>
								</div>
								<!-- DTF-Ratgeber (disabled for now)
								<div>
									<h4 class="font-semibold text-neutral mb-2 text-sm">DTF-Ratgeber</h4>
									<ul class="space-y-2 pl-6">
										<li>
											<a href="/dtf-ratgeber-und-infos/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												DTF Grundlagen
											</a>
										</li>
										<li>
											<a href="/dtf-druck/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												DTF Druckprozess
											</a>
										</li>
										<li>
											<a href="/dtf-haltbarkeit/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												DTF Haltbarkeit
											</a>
										</li>
										<li>
											<a href="/infos-zu-printpunk/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Tipps & Tricks
											</a>
										</li>
										<li>
											<a href="/textildruckverfahren/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Textildruckverfahren
											</a>
										</li>
									</ul>
								</div>
								-->
								<!-- Support -->
								<div>
									<h4 class="font-semibold text-neutral mb-2 text-sm">Support & FAQ</h4>
									<ul class="space-y-2 pl-6">
										<li>
											<a href="/faq/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Häufige Fragen
											</a>
										</li>
										<li>
											<a href="/kontakt/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Kontakt
											</a>
										</li>
										<li>
											<a href="/support/" class="text-neutral/70 menu-link-hover text-sm py-1 transition-colors block">
												Technischer Support
											</a>
										</li>
									</ul>
								</div>
								<div class="pt-2">
									<div class="text-center p-3 bg-base-200 rounded-lg">
										<p class="text-xs text-neutral/60 mb-2">24/7 Support</p>
										<a href="https://wa.me/4917660976813" target="_blank" rel="noopener noreferrer" aria-label="Jetzt anrufen (WhatsApp)" class="btn btn-outline btn-primary btn-xs">Jetzt anrufen</a>
									</div>
								</div>
							</div>
						</details>

						<!-- Muster bestellen -->
						<div class="pt-4 border-t border-base-300/20">
							<a href="/muster-bestellen/" class="text-neutral/80 menu-link-hover text-base font-medium py-2 transition-colors block">
								Muster bestellen
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Mega Menu Styles -->
<style>
	/* Navbar scroll (no slide animation) */
	.navbar-scroll-container {
		transform: translateY(0);
	}

	.navbar-scroll-container.navbar-hidden {
		transform: translateY(-100%);
	}

	.mega-menu {
		display: flex;
		flex-wrap: wrap;
		gap: 0.25rem;
	}

	/* Add a pseudo-element to bridge the gap between label and dropdown */
	.mega-dropdown::before {
		content: '';
		position: absolute;
		top: 100%;
		left: 0;
		right: 0;
		height: 0.5rem;
		pointer-events: none;
	}

	.mega-dropdown:hover::before {
		pointer-events: auto;
	}

	/* Mega menu button hover states */
	.mega-dropdown button:hover > svg {
		transform: rotate(180deg);
	}

	/* Center dropdowns on viewport, with overflow protection */
	.mega-dropdown-content {
		/* Center relative to parent dropdown */
		left: 50%;
		transform: translateX(-50%) translateY(2px);
		pointer-events: none;
		transition: opacity 0.3s ease-out, visibility 0.3s ease-out, transform 0.3s ease-out;
		transition-delay: 0s, 0s, 0s;
		/* Width: responsive - full width on small/medium screens */
		width: calc(100vw - 2rem);
		/* Ensure max-width never exceeds viewport */
		/* The max-w-* classes in HTML will further constrain on larger screens */
		max-width: calc(100vw - 2rem);
		/* Box-sizing to include padding in width calculation */
		box-sizing: border-box;
	}

	.mega-dropdown:hover .mega-dropdown-content,
	.mega-dropdown:focus-within .mega-dropdown-content,
	.mega-dropdown-content:hover {
		opacity: 1;
		visibility: visible;
		transform: translateX(-50%) translateY(0);
		transition-delay: 0s;
	}

	/* Set aria-expanded when dropdown is visible */
	.mega-dropdown:hover button[aria-haspopup="true"],
	.mega-dropdown:focus-within button[aria-haspopup="true"] {
		aria-expanded: true;
	}

	/* Close dropdowns when scrolling */
	.navbar-scrolling .mega-dropdown:hover .mega-dropdown-content,
	.navbar-scrolling .mega-dropdown-content,
	.navbar-scrolling .mega-dropdown-content:hover {
		opacity: 0 !important;
		visibility: hidden !important;
		pointer-events: none !important;
	}

	.navbar-scrolling .user-dropdown:hover .user-dropdown-content,
	.navbar-scrolling .user-dropdown-content,
	.navbar-scrolling .user-dropdown-content:hover {
		opacity: 0 !important;
		visibility: hidden !important;
		pointer-events: none !important;
	}

	.navbar-scrolling .cart-dropdown:hover .cart-dropdown-content,
	.navbar-scrolling .cart-dropdown-content,
	.navbar-scrolling .cart-dropdown-content:hover {
		opacity: 0 !important;
		visibility: hidden !important;
		pointer-events: none !important;
	}

	/* Shift Produkte dropdown slightly to the right */
	.mega-dropdown-produkte .mega-dropdown-content {
		left: 50%;
		transform: translateX(calc(-50% + 6rem)) translateY(2px);
	}

	.mega-dropdown-produkte:hover .mega-dropdown-content,
	.mega-dropdown-produkte .mega-dropdown-content:hover {
		transform: translateX(calc(-50% + 6rem)) translateY(0);
	}

	/* Allow menu items to wrap to multiple lines - apply to all dropdowns */
	.mega-dropdown-content a {
		word-wrap: break-word !important;
		overflow-wrap: break-word !important;
		word-break: break-word !important;
		white-space: normal !important;
		hyphens: auto;
		line-height: 1.4;
		max-width: 100%;
	}
	
	/* Ensure list items don't prevent wrapping */
	.mega-dropdown-content li {
		width: 100%;
		max-width: 100%;
		overflow-wrap: break-word;
	}
	
	/* Ensure columns have proper width constraints */
	.mega-dropdown-content .grid > div {
		min-width: 0;
		overflow-wrap: break-word;
	}

	.mega-dropdown:hover > label svg,
	.mega-dropdown:hover > button svg {
		transform: rotate(180deg);
	}

	.mega-dropdown:not(:hover) .mega-dropdown-content {
		opacity: 0;
		visibility: hidden;
		transform: translateX(-50%) translateY(2px);
		transition-delay: 0.15s;
	}

	.mega-dropdown-produkte:not(:hover) .mega-dropdown-content {
		transform: translateX(calc(-50% + 6rem)) translateY(2px);
	}

	.mega-dropdown:not(:hover) .products-dropdown {
		transform: translateX(-50%) translateY(2px);
	}

	.mega-dropdown:hover .mega-dropdown-content {
		pointer-events: auto;
	}

	.mega-dropdown {
		position: relative;
	}

	.mega-dropdown-content:hover {
		pointer-events: auto;
	}

	/* Desktop: Single row, no wrap */
	@media (min-width: 1024px) {
		.mega-menu {
			flex-wrap: nowrap;
			gap: 0.5rem;
		}

		.mega-menu li a,
		.mega-menu li label {
			white-space: nowrap;
			font-size: 1rem;
			padding-left: 0.75rem;
			padding-right: 0.75rem;
		}
	}

	/* Tablet: Maximum 2 rows */
	@media (min-width: 768px) and (max-width: 1023px) {
		.mega-menu {
			justify-content: center;
			overflow: visible;
		}

		.mega-menu li a,
		.mega-menu li label {
			font-size: 0.875rem;
		}

		/* Ensure dropdowns don't overflow on tablets */
		.mega-dropdown-content {
			/* On tablets, use full width minus margins */
			max-width: calc(100vw - 2rem);
			width: calc(100vw - 2rem);
		}
	}
	
	/* Desktop: Proper centering with max-width constraints */
	@media (min-width: 1024px) {
		/* Base width for all dropdowns */
		.mega-dropdown-content {
			width: 750px;
			max-width: calc(100vw - 2rem);
		}

		/* Produkte dropdown: 900px for hierarchical layout (matches max-w-[900px]) */
		.mega-dropdown-produkte .mega-dropdown-content {
			width: 900px;
		}

		/* Dienstleistungen dropdown: 600px (matches max-w-[600px]) */
		.mega-dropdown-dienstleistungen .mega-dropdown-content {
			width: 600px;
		}

		/* Informationen dropdown: 750px (matches max-w-[750px]) */
		.mega-dropdown-informationen .mega-dropdown-content {
			width: 750px;
		}

		/* Themen dropdown: 800px (matches max-w-[800px]) */
		.mega-dropdown-themen .mega-dropdown-content {
			width: 800px;
		}
	}

	/* User dropdown styles */
	.user-dropdown:hover .user-dropdown-content,
	.user-dropdown-content:hover {
		opacity: 1;
		visibility: visible;
		transform: translateY(0);
		transition-delay: 0s;
	}

	.user-dropdown:not(:hover) .user-dropdown-content {
		opacity: 0;
		visibility: hidden;
		transform: translateY(2px);
		transition-delay: 0.15s;
	}

	/* Mobile: Burger menu (navbar-center is hidden, these styles won't apply) */
	@media (max-width: 767px) {
		.mega-menu {
			flex-direction: column;
			align-items: center;
			gap: 0.5rem;
		}

		.mega-dropdown {
			width: 100%;
		}

		.mega-dropdown-content {
			position: static !important;
			opacity: 1 !important;
			visibility: visible !important;
			transform: none !important;
			box-shadow: none !important;
			border: 1px solid rgba(209, 213, 219, 0.3) !important;
			margin-top: 0.5rem !important;
			max-width: none !important;
			width: 100% !important;
			display: none;
		}

		.mega-dropdown:hover .mega-dropdown-content {
			display: block;
		}

		/* Mobile menu collapsible sections */
		.mobile-menu-section {
			border-bottom: 1px solid rgba(209, 213, 219, 0.2);
			padding-bottom: 1rem;
		}

		.mobile-menu-section:last-of-type {
			border-bottom: none;
		}

		.mobile-menu-section summary {
			list-style: none;
		}

		.mobile-menu-section summary::-webkit-details-marker {
			display: none;
		}

		.mobile-menu-section[open] .mobile-menu-chevron {
			transform: rotate(180deg);
		}

		.mobile-menu-section summary:hover {
			opacity: 0.8;
		}

		/* Center mobile menu dropdown on mobile screens */
		#mobile-menu-dropdown.dropdown-end .dropdown-content {
			position: fixed !important;
			left: 50% !important;
			transform: translateX(-50%) !important;
			right: auto !important;
		}

		.user-dropdown .user-dropdown-content {
			position: absolute !important;
			right: 0 !important;
			top: calc(100% + 0.75rem) !important;
			opacity: 0 !important;
			visibility: hidden !important;
			transform: translateY(2px) !important;
			box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
			border: 1px solid rgba(209, 213, 219, 0.3) !important;
			margin-top: 0 !important;
			width: 20rem !important;
			max-width: calc(100vw - 2rem) !important;
			display: block !important;
		}

		.user-dropdown:focus-within .user-dropdown-content,
		.user-dropdown-content:focus-within {
			opacity: 1 !important;
			visibility: visible !important;
			transform: translateY(0) !important;
		}
	}
</style>

<!-- Auth Modal -->
<AuthModal />

<!-- Client-side Auth Scripts -->
<script>
	import { authClient } from '../lib/auth-client';

	// Open auth modal when clicking the user icon
	const authIconButton = document.getElementById('auth-icon-button');
	if (authIconButton) {
		authIconButton.addEventListener('click', () => {
			(window as any).openAuthModal('login');
		});
	}

	// Mobile menu toggle functionality
	const mobileMenuButton = document.getElementById('mobile-menu-button');
	const mobileMenuContent = document.getElementById('mobile-menu-content');
	const mobileMenuDropdown = document.getElementById('mobile-menu-dropdown');

	if (mobileMenuButton && mobileMenuContent && mobileMenuDropdown) {
		let isMenuOpen = false;

		mobileMenuButton.addEventListener('click', (e) => {
			e.preventDefault();
			e.stopPropagation();

			if (isMenuOpen) {
				// Close menu
				mobileMenuButton.blur();
				mobileMenuContent.blur();
				document.activeElement?.blur();
				isMenuOpen = false;
			} else {
				// Open menu
				mobileMenuContent.focus();
				isMenuOpen = true;
			}
		});

		// Close menu when clicking outside
		document.addEventListener('click', (e) => {
			if (isMenuOpen && !mobileMenuDropdown.contains(e.target as Node)) {
				mobileMenuButton.blur();
				mobileMenuContent.blur();
				isMenuOpen = false;
			}
		});

		// Close menu when clicking a link inside
		mobileMenuContent.addEventListener('click', (e) => {
			const target = e.target as HTMLElement;
			if (target.tagName === 'A' || target.closest('a')) {
				mobileMenuButton.blur();
				mobileMenuContent.blur();
				isMenuOpen = false;
			}
		});
	}

	// Handle logout
	const logoutButton = document.getElementById('logout-button');
	if (logoutButton) {
		logoutButton.addEventListener('click', async (e) => {
			e.preventDefault();
			try {
				await authClient.signOut();
				window.location.href = '/';
			} catch (error) {
				console.error('Logout error:', error);
				alert('Abmeldung fehlgeschlagen. Bitte versuche es erneut.');
			}
		});
	}

	// Navbar scroll behavior: hide on scroll down, show on scroll up
	const navbarContainer = document.getElementById('navbar-container');
	if (navbarContainer) {
		let lastScrollY = window.scrollY;
		let ticking = false;

		const updateNavbar = () => {
			const currentScrollY = window.scrollY;
			
			// Close all dropdowns when scrolling
			if (Math.abs(currentScrollY - lastScrollY) > 0) {
				// Add class to force close dropdowns via CSS
				navbarContainer.classList.add('navbar-scrolling');
				
				// Close mobile menu dropdown (DaisyUI) by blurring focus
				const mobileMenuDropdown = document.querySelector('.dropdown.dropdown-end.md\\:hidden');
				if (mobileMenuDropdown) {
					const label = mobileMenuDropdown.querySelector('label[tabindex="0"]') as HTMLElement;
					if (label) {
						label.blur();
					}
					const dropdownContent = mobileMenuDropdown.querySelector('.dropdown-content') as HTMLElement;
					if (dropdownContent) {
						dropdownContent.blur();
					}
					// Also remove focus from the dropdown container
					(mobileMenuDropdown as HTMLElement).blur();
				}

				// Close cart dropdown (DaisyUI) by blurring focus
				const cartDropdown = document.querySelector('.cart-dropdown');
				if (cartDropdown) {
					const button = cartDropdown.querySelector('button[tabindex="0"]') as HTMLElement;
					if (button) {
						button.blur();
					}
					const dropdownContent = cartDropdown.querySelector('.cart-dropdown-content') as HTMLElement;
					if (dropdownContent) {
						dropdownContent.blur();
					}
					// Also remove focus from the dropdown container
					(cartDropdown as HTMLElement).blur();
				}
				
				// Remove the scrolling class after a short delay to allow hover to work again
				setTimeout(() => {
					navbarContainer.classList.remove('navbar-scrolling');
				}, 150);
			}
			
			// Only hide/show if scrolled past a threshold (e.g., 50px)
			if (Math.abs(currentScrollY - lastScrollY) < 5) {
				ticking = false;
				return;
			}

			if (currentScrollY > lastScrollY && currentScrollY > 50) {
				// Scrolling down - hide navbar
				navbarContainer.classList.add('navbar-hidden');
			} else if (currentScrollY < lastScrollY) {
				// Scrolling up - show navbar
				navbarContainer.classList.remove('navbar-hidden');
			}

			// Always show navbar at the top of the page
			if (currentScrollY < 10) {
				navbarContainer.classList.remove('navbar-hidden');
			}

			lastScrollY = currentScrollY;
			ticking = false;
		};

		const onScroll = () => {
			if (!ticking) {
				window.requestAnimationFrame(updateNavbar);
				ticking = true;
			}
		};

		window.addEventListener('scroll', onScroll, { passive: true });
	}
</script>
