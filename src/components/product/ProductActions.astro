---
interface Props {
	productId: string;
	productName: string;
	price: number;
	inStock: boolean;
}

const { productId, productName, price, inStock } = Astro.props;

const formatPrice = (price: number) => {
	return new Intl.NumberFormat('de-DE', {
		style: 'currency',
		currency: 'EUR'
	}).format(price);
};
---

<div class="product-actions space-y-8" data-product-name={productName} data-product-price={price}>
	<!-- Quantity Selector -->
	<div class="space-y-3">
		<label class="text-neutral/70 text-sm font-medium">Menge</label>
		<div class="flex items-center gap-4">
			<button
				class="text-neutral hover:text-primary transition-colors cursor-pointer"
				id="quantity-decrease"
				aria-label="Menge reduzieren"
			>
				<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
					<path stroke-linecap="round" stroke-linejoin="round" d="M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
				</svg>
			</button>
			<input
				type="number"
				value="1"
				min="1"
				max="100"
				class="input input-bordered w-24 text-center text-xl font-semibold text-neutral border-2 no-spinner"
				id="quantity-input"
			/>
			<button
				class="text-neutral hover:text-primary transition-colors cursor-pointer"
				id="quantity-increase"
				aria-label="Menge erhöhen"
			>
				<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
					<path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
				</svg>
			</button>
		</div>
	</div>

	<!-- Total Price Display -->
	<div class="bg-base-200/30 rounded-2xl p-6">
		<div class="flex justify-between items-baseline">
			<span class="text-neutral/60 text-lg">Gesamtpreis</span>
			<span class="text-4xl font-bold text-neutral" id="total-price">
				{formatPrice(price)}
			</span>
		</div>
	</div>

	<!-- Action Buttons -->
	<div class="space-y-4">
		{inStock ? (
			<>
				<button
					class="btn btn-primary btn-lg w-full text-lg font-semibold shadow-lg hover:shadow-xl transition-all"
					id="order-btn"
				>
					Jetzt bestellen
				</button>
				<button
					class="btn btn-outline btn-lg w-full text-lg"
					id="quote-btn"
				>
					Angebot anfordern
				</button>
			</>
		) : (
			<button
				class="btn btn-disabled btn-lg w-full text-lg"
				disabled
			>
				Nicht verfügbar
			</button>
		)}
	</div>

	<!-- Trust Badges -->
	<div class="grid grid-cols-1 gap-4 pt-6 border-t border-base-300/20">
		<div class="flex items-center gap-3 text-sm text-neutral/70">
			<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
			</svg>
			<span>Schnelle Lieferung in 3-5 Werktagen</span>
		</div>
		<div class="flex items-center gap-3 text-sm text-neutral/70">
			<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
			</svg>
			<span>Premium Qualität garantiert</span>
		</div>
		<div class="flex items-center gap-3 text-sm text-neutral/70">
			<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-success flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
			</svg>
			<span>Sicherer Checkout & Zahlung</span>
		</div>
	</div>
</div>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const quantityInput = document.getElementById('quantity-input') as HTMLInputElement;
		const quantityDecrease = document.getElementById('quantity-decrease');
		const quantityIncrease = document.getElementById('quantity-increase');
		const totalPrice = document.getElementById('total-price');
		const orderBtn = document.getElementById('order-btn');
		const quoteBtn = document.getElementById('quote-btn');
		const productContainer = document.querySelector('[data-product-price]');

		if (!quantityInput || !totalPrice || !productContainer) return;

		const basePrice = parseFloat(productContainer.getAttribute('data-product-price') || '0');
		const productName = productContainer.getAttribute('data-product-name') || 'Produkt';

		const formatPrice = (price: number) => {
			return new Intl.NumberFormat('de-DE', {
				style: 'currency',
				currency: 'EUR'
			}).format(price);
		};

		const updateTotal = () => {
			const quantity = parseInt(quantityInput.value) || 1;
			const total = basePrice * quantity;
			if (totalPrice) {
				totalPrice.textContent = formatPrice(total);
			}
		};

		quantityDecrease?.addEventListener('click', () => {
			const current = parseInt(quantityInput.value) || 1;
			if (current > 1) {
				quantityInput.value = (current - 1).toString();
				updateTotal();
			}
		});

		quantityIncrease?.addEventListener('click', () => {
			const current = parseInt(quantityInput.value) || 1;
			if (current < 100) {
				quantityInput.value = (current + 1).toString();
				updateTotal();
			}
		});

		quantityInput.addEventListener('input', () => {
			const value = parseInt(quantityInput.value);
			if (value < 1) quantityInput.value = '1';
			if (value > 100) quantityInput.value = '100';
			updateTotal();
		});

		orderBtn?.addEventListener('click', () => {
			const quantity = parseInt(quantityInput.value) || 1;
			// In a real app, this would add to cart or redirect to checkout
			alert(`Bestellung: ${quantity}x ${productName} - ${formatPrice(basePrice * quantity)}`);
		});

		quoteBtn?.addEventListener('click', () => {
			const quantity = parseInt(quantityInput.value) || 1;
			// In a real app, this would open a contact form or redirect
			alert(`Angebot anfordern für: ${quantity}x ${productName}`);
		});
	});
</script>

<style>
	/* Hide number input spinner buttons */
	.no-spinner::-webkit-outer-spin-button,
	.no-spinner::-webkit-inner-spin-button {
		-webkit-appearance: none;
		margin: 0;
	}

	.no-spinner {
		-moz-appearance: textfield;
	}
</style>
