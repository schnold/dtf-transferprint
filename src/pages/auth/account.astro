---
import Layout from '../../layouts/Layout.astro';

const user = Astro.locals.user;

// If not logged in, redirect to login page
if (!user) {
  return Astro.redirect('/auth/login');
}
---

<Layout title="My Account - DTF Transfer Print">
  <div class="min-h-screen bg-base-200 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-3xl mx-auto">
      <div class="bg-base-100 shadow-xl rounded-lg overflow-hidden">
        <div class="p-8">
          <div class="flex items-center justify-between mb-6">
            <h1 class="text-3xl font-bold">My Account</h1>
            <button id="logout-button" class="btn btn-error btn-sm">
              Sign Out
            </button>
          </div>

          <div class="space-y-6">
            <div class="border-b border-base-300 pb-4">
              <h2 class="text-xl font-semibold mb-4">Profile Information</h2>
              <div class="space-y-3">
                <div>
                  <label class="text-sm font-medium text-base-content/70">Name</label>
                  <p class="text-lg">{user.name}</p>
                </div>
                <div>
                  <label class="text-sm font-medium text-base-content/70">Email</label>
                  <p class="text-lg">{user.email}</p>
                </div>
                <div>
                  <label class="text-sm font-medium text-base-content/70">Email Verified</label>
                  <div class="flex items-center gap-2">
                    {user.emailVerified ? (
                      <span class="badge badge-success">Verified</span>
                    ) : (
                      <span class="badge badge-warning">Not Verified</span>
                    )}
                  </div>
                </div>
              </div>
            </div>

            <div class="border-b border-base-300 pb-4">
              <h2 class="text-xl font-semibold mb-4">Account Security</h2>
              <div class="space-y-3">
                <div>
                  <label class="text-sm font-medium text-base-content/70">Account Status</label>
                  <p class="text-lg">
                    {user.accountLocked ? (
                      <span class="badge badge-error">Locked</span>
                    ) : (
                      <span class="badge badge-success">Active</span>
                    )}
                  </p>
                </div>
                <div>
                  <label class="text-sm font-medium text-base-content/70">Account Created</label>
                  <p class="text-lg">
                    {new Date(user.createdAt).toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </p>
                </div>
                {user.lastLoginAt && (
                  <div>
                    <label class="text-sm font-medium text-base-content/70">Last Login</label>
                    <p class="text-lg">
                      {new Date(user.lastLoginAt).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                      })}
                    </p>
                  </div>
                )}
              </div>
            </div>

            <div>
              <h2 class="text-xl font-semibold mb-4">Security Information</h2>
              <div class="alert alert-info">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span>
                  Your account is protected with secure password hashing and session management.
                  All login attempts are monitored for suspicious activity.
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  import { authClient } from '../../lib/auth-client';

  const logoutButton = document.getElementById('logout-button');

  logoutButton?.addEventListener('click', async () => {
    try {
      await authClient.signOut();
      window.location.href = '/';
    } catch (error) {
      console.error('Logout error:', error);
      alert('Failed to sign out. Please try again.');
    }
  });
</script>
